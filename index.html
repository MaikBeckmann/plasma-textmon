<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
               "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Digitize your TextMon :D</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
<meta name="title" content="Digitize your TextMon :D"/>
<meta name="generator" content="Org-mode"/>
<meta name="generated" content="2012-02-12 13:15:37 CET"/>
<meta name="author" content="Maik Beckmann &amp;lt;beckmann.maik@googlemail.com&amp;gt;"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  html { font-family: Times, serif; font-size: 12pt; }
  .title  { text-align: center; }
  .todo   { color: red; }
  .done   { color: green; }
  .tag    { background-color: #add8e6; font-weight:normal }
  .target { }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  {margin-left:auto; margin-right:0px;  text-align:right;}
  .left   {margin-left:0px;  margin-right:auto; text-align:left;}
  .center {margin-left:auto; margin-right:auto; text-align:center;}
  p.verse { margin-left: 3% }
  pre {
	border: 1pt solid #AEBDCC;
	background-color: #F3F5F7;
	padding: 5pt;
	font-family: courier, monospace;
        font-size: 90%;
        overflow:auto;
  }
  table { border-collapse: collapse; }
  td, th { vertical-align: top;  }
  th.right  { text-align:center;  }
  th.left   { text-align:center;   }
  th.center { text-align:center; }
  td.right  { text-align:right;  }
  td.left   { text-align:left;   }
  td.center { text-align:center; }
  dt { font-weight: bold; }
  div.figure { padding: 0.5em; }
  div.figure p { text-align: center; }
  div.inlinetask {
    padding:10px;
    border:2px solid gray;
    margin:10px;
    background: #ffffcc;
  }
  textarea { overflow-x: auto; }
  .linenr { font-size:smaller }
  .code-highlighted {background-color:#ffff00;}
  .org-info-js_info-navigation { border-style:none; }
  #org-info-js_console-label { font-size:10px; font-weight:bold;
                               white-space:nowrap; }
  .org-info-js_search-highlight {background-color:#ffff00; color:#000000;
                                 font-weight:bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="org-mode.css"/>
<script type="text/javascript">
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/javascript" src="http://orgmode.org/mathjax/MathJax.js">
<!--/*--><![CDATA[/*><!--*/
    MathJax.Hub.Config({
        // Only one of the two following lines, depending on user settings
        // First allows browser-native MathML display, second forces HTML/CSS
        //  config: ["MMLorHTML.js"], jax: ["input/TeX"],
            jax: ["input/TeX", "output/HTML-CSS"],
        extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js",
                     "TeX/noUndefined.js"],
        tex2jax: {
            inlineMath: [ ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"], ["\\begin{displaymath}","\\end{displaymath}"] ],
            skipTags: ["script","noscript","style","textarea","pre","code"],
            ignoreClass: "tex2jax_ignore",
            processEscapes: false,
            processEnvironments: true,
            preview: "TeX"
        },
        showProcessingMessages: true,
        displayAlign: "center",
        displayIndent: "2em",

        "HTML-CSS": {
             scale: 100,
             availableFonts: ["STIX","TeX"],
             preferredFont: "TeX",
             webFont: "TeX",
             imageFont: "TeX",
             showMathMenu: true,
        },
        MMLorHTML: {
             prefer: {
                 MSIE:    "MML",
                 Firefox: "MML",
                 Opera:   "HTML",
                 other:   "HTML"
             }
        }
    });
/*]]>*///-->
</script>
</head>
<body>

<div id="preamble">

</div>

<div id="content">
<h1 class="title">Digitize your TextMon :D</h1>




<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1 Introduction</a></li>
<li><a href="#sec-2">2 Hello Javascript</a>
<ul>
<li><a href="#sec-2-1">2.1 Install a Javascript interpreter</a></li>
<li><a href="#sec-2-2">2.2 Not Ubuntu</a>
<ul>
<li><a href="#sec-2-2-1">2.2.1 js</a></li>
<li><a href="#sec-2-2-2">2.2.2 v8</a></li>
<li><a href="#sec-2-2-3">2.2.3 rhino</a></li>
</ul>
</li>
<li><a href="#sec-2-3">2.3 Hello World</a></li>
</ul>
</li>
<li><a href="#sec-3">3 Hello Plasma</a>
<ul>
<li><a href="#sec-3-1">3.1 And there was metadata</a></li>
<li><a href="#sec-3-2">3.2 plasmapkg and life ain't easy</a></li>
<li><a href="#sec-3-3">3.3 Give yourself a treat: Good error messages</a></li>
</ul>
</li>
<li><a href="#sec-4">4 Hello?</a>
<ul>
<li><a href="#sec-4-1">4.1 Getting more than one shot</a></li>
<li><a href="#sec-4-2">4.2 A sink with a slot</a></li>
<li><a href="#sec-4-3">4.3 Connecting the slot to a source</a></li>
<li><a href="#sec-4-4">4.4 Exploring a data source</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Introduction</h2>
<div class="outline-text-2" id="text-1">

<p>This guide aims to show you how to code a simple sytem minitor plasma applet in
Javascript.
</p>
</div>

</div>

<div id="outline-container-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Hello Javascript</h2>
<div class="outline-text-2" id="text-2">


</div>

<div id="outline-container-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> Install a Javascript interpreter</h3>
<div class="outline-text-3" id="text-2-1">

</div>

</div>

<div id="outline-container-2-2" class="outline-3">
<h3 id="sec-2-2"><span class="section-number-3">2.2</span> Not Ubuntu</h3>
<div class="outline-text-3" id="text-2-2">


</div>

<div id="outline-container-2-2-1" class="outline-4">
<h4 id="sec-2-2-1"><span class="section-number-4">2.2.1</span> js</h4>
<div class="outline-text-4" id="text-2-2-1">

<p>This is Mozilla's command line Javascript interpreter.  It's what I'll be using
throughout this document, like
</p><pre class="example">
% js foobar.js
</pre>


<p>
The package which contains this executable
</p><dl>
<dt>js</dt><dd>for ArchLinux, OpenSUSE and Fedora
</dd>
<dt>spidermonkey-bin</dt><dd>for Debian
</dd>
</dl>


<p>
It is <span style="text-decoration:underline;">not</span> available on <b>Ubuntu</b>.  You have to use one of the two following.
</p>
</div>

</div>

<div id="outline-container-2-2-2" class="outline-4">
<h4 id="sec-2-2-2"><span class="section-number-4">2.2.2</span> v8</h4>
<div class="outline-text-4" id="text-2-2-2">

<p>The <code>v8</code> package contains the <code>d8</code> Javscript interpreter.  When this documention says
</p><pre class="example">
% js foobar.js
</pre>

<p>then you can use
</p><pre class="example">
% d8 foobar.js
</pre>

<p>instead.
</p>
</div>

</div>

<div id="outline-container-2-2-3" class="outline-4">
<h4 id="sec-2-2-3"><span class="section-number-4">2.2.3</span> rhino</h4>
<div class="outline-text-4" id="text-2-2-3">

<p>This is an Java implementation.  It will take forever to startup the first time
it runs, but after that it's ok.  When this documention says
</p><pre class="example">
% js foobar.js
</pre>

<p>then you can use
</p><pre class="example">
% rhino foobar.js
</pre>

<p>instead.
</p>
<p>
Note: Only about Ubuntu I know for certain that it's <code>rhino</code> package includes
the <code>/usr/bin/rhino</code> shell script.  On Archlinux you'd have to do
</p><pre class="example">
% java -jar /usr/share/java/js.jar foobar.js
</pre>


</div>
</div>

</div>

<div id="outline-container-2-3" class="outline-3">
<h3 id="sec-2-3"><span class="section-number-3">2.3</span> Hello World</h3>
<div class="outline-text-3" id="text-2-3">

<p>Open your favorite editor and create the file <code>foobar.js</code> with the content
</p>


<pre class="src src-js">print(<span class="org-string">"Hello World!"</span>);
</pre>

<p>
and run it in a shell
</p><pre class="example">
% js foobar.js
Hello World!
</pre>


</div>
</div>

</div>

<div id="outline-container-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Hello Plasma</h2>
<div class="outline-text-2" id="text-3">


</div>

<div id="outline-container-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> And there was metadata</h3>
<div class="outline-text-3" id="text-3-1">

<p>We aim to have plasma run our little world script.
</p>


<pre class="src src-js">print(<span class="org-string">"hello world"</span>);
</pre>

<p>
For this we have to create a plasma package.  A package consists of its
content, our Javascript file, and meta data that describes this content and its
role.  The file tree of the simplest possible package looks like this
</p><pre class="example">
hello_world
├── contents
│   └── main.js
└── metadata.desktop
</pre>

<p>The simplest possible and barely working meta data is
</p>


<pre class="src src-conf">[<span class="org-type">Desktop Entry</span>]
<span class="org-variable-name">Type</span>=Service
<span class="org-variable-name">X-Plasma-API</span>=javascript
<span class="org-variable-name">X-Plasma-MainScript</span>=main.js
</pre>

<p>
Now change to the directory <code>hello_world</code>, which contains the <code>metadata.desktop</code>
file, and execute
</p><pre class="example">
plasmoidviewer .
</pre>

<p>An empty default applet appears, since we haven't done anything to the user
interface yet, and the text
</p><pre class="example">
hello world
</pre>

<p>appears in the shell where we started plasmoidviewer
</p>
<div id="fig-empty_default" class="figure">
<p><img src="images/empty_default_applet.png" width="150" alt="images/empty_default_applet.png" /></p>
<p>Empty default applet</p>
</div>

</div>

</div>

<div id="outline-container-3-2" class="outline-3">
<h3 id="sec-3-2"><span class="section-number-3">3.2</span> plasmapkg and life ain't easy</h3>
<div class="outline-text-3" id="text-3-2">

<p>To make our applet be usable for plasma we have to install it.  We'll install
it into our user directory
</p><pre class="example">
% echo $(kde4-config --localprefix)
</pre>

<p>which will be something like <code>/home/YOU/.kde</code> or <code>/home/YOU/.kde4</code>, just paste
it into the shel and see for yourself.  The follwing command does the
installation
</p><pre class="example">
% plasmapkg -i .
</pre>

<p>But it won't work.  It fails with
</p><pre class="example">
plasmapkg(24248)/libplasma Plasma::Package::installPackage: Package plugin name not specified
Installation of /home/maik/.../hello_world failed.
</pre>

<p>Okay, lets add a name.  The name is provided by <code>X-KDE-PluginInfo-Name</code>
</p>


<pre class="src src-conf">[<span class="org-type">Desktop Entry</span>]
<span class="org-variable-name">Type</span>=Service

<span class="org-variable-name">X-KDE-PluginInfo-Name</span>=HelloFoobar
<span class="org-variable-name">X-Plasma-API</span>=javascript
<span class="org-variable-name">X-Plasma-MainScript</span>=main.js
</pre>

<p>
Lets try again
</p><pre class="example">
% plasmapkg -i .
Successfully installed /home/maik/Projekte/kde/plasmoids/javascript/textmon_tut/hello_world
</pre>

<p>Yay!  Now we want to run it.  Plasmoidviewer can to do that as well.  Instead
of giving a path to it, we give the name we've put into the meta data
</p><pre class="example">
% plasmoidviewer HelloFoobar
</pre>

<p>But it won't work, again.  You get
</p>
<div id="fig-missing_servicetypes" class="figure">
<p><img src="images/missing_servicetypes.png" width="250" alt="images/missing_servicetypes.png" /></p>
<p>Missing X-KDE-ServiceTypes</p>
</div>
<p>
BUMMER!  But wait, there is more fail to come.  Before I explain what is
missing, lets try to get rid if the faulty installation.  You generally can
remove plasma components with
</p><pre class="example">
% plasmapkg -r PACKAGENAME
</pre>

<p>But
</p><pre class="example">
% plasmapkg -r HelloFoobar
</pre>

<p>results in
</p><pre class="example">
Plugin HelloFoobar is not installed.
</pre>

<p>WAT?  That is clearly not correct.  It is a bug in plasmapkg that I'll report
ASAP, I promise.  I the mean time do this
</p><pre class="example">
% rm $(kde4-config --localprefix)/share/kde4/services/plasma-applet-HelloFoobar.desktop
% rm $(kde4-config --localprefix)/share/apps/plasma/plasmoids/HelloFoobar/ -r
</pre>


<p>
What we have to add is the role this <i>Service</i> named <i>HelloFoobar</i> plays.  It's
a plasma applet:
</p>


<pre class="src src-conf">[<span class="org-type">Desktop Entry</span>]
<span class="org-variable-name">Type</span>=Service

<span class="org-variable-name">X-KDE-PluginInfo-Name</span>=HelloFoobar
<span class="org-variable-name">X-KDE-ServiceTypes</span>=Plasma/Applet

<span class="org-variable-name">X-Plasma-API</span>=javascript
<span class="org-variable-name">X-Plasma-MainScript</span>=main.js
</pre>

<p>
No we not only get
</p><pre class="example">
% plasmapkg -i .
Successfully installed /home/maik/Projekte/kde/plasmoids/javascript/textmon_tut/hello_world
</pre>

<p>but also
</p><pre class="example">
% plasmoidviewer HelloFoobar
hello world
</pre>

<p>Yay :D
</p>
</div>

</div>

<div id="outline-container-3-3" class="outline-3">
<h3 id="sec-3-3"><span class="section-number-3">3.3</span> Give yourself a treat: Good error messages</h3>
<div class="outline-text-3" id="text-3-3">

<p>Consider this code
</p>


<pre class="src src-js">array = [1, 2, 3];
</pre>

<p>
and break it
<code>foobar.js</code>
</p>


<pre class="src src-js">array = [1, 2 3];
</pre>

<p>
Put that into our main.js and see what plasma has to say
</p><pre class="example">
% plasmoidviwer .
</pre>

<p>We get this:
</p>
<div id="fig-missing_servicetypes" class="figure">
<p><img src="images/syntax_error.png" width="250" alt="images/syntax_error.png" /></p>
<p>Syntax Error: Parse Error.  This means: dunno!</p>
</div>
<p>
Well ok, parsing a programming language is hard.  I'm sure they done as good as
anybody can ask for, right?  Lets see what the contenders have to say. Here
Mozilla's js
</p><pre class="example">
% js main.js
main.js:1: SyntaxError: missing ] after element list:
main.js:1: array = [1, 2 3];
main.js:1: ..............^
</pre>

<p>or Google's v8 (its command line debugger is called d8)
 :% d8 main.js
</p><pre class="example">
main.js:1: SyntaxError: Unexpected number
array = [1, 2 3];
              ^
SyntaxError: Unexpected number
</pre>

<p>or rhino, as well done by Mozilla
</p><pre class="example">
% rhino main.js
js: "main.js", line 1: missing ] after element list
js: array = [1, 2 3];
js: ...............^
</pre>

<p>Rhino is off by one dot, but still: wow!
</p>
<p>
A missing comma, brace and bracet is an frequent coding error.  QtScript will
give you the line number, that's it.  If you have no idea what the heck it's
problem is, do yourself a favor by pasting the code in question into file and
have one of the above Javascript interpreters a run at it.  They of cause won't
be able to run it, but they'll find the syntax error with a <span style="text-decoration:underline;">sweet</span> error
message.
</p>
</div>
</div>

</div>

<div id="outline-container-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Hello?</h2>
<div class="outline-text-2" id="text-4">


</div>

<div id="outline-container-4-1" class="outline-3">
<h3 id="sec-4-1"><span class="section-number-3">4.1</span> Getting more than one shot</h3>
<div class="outline-text-3" id="text-4-1">

<p>Our script is run exactly once!  To get more than this single run, we have to
convince plasma to give us additional cpu cycles.  this is done by defining a
data sink and connecting it to a source.
</p>
</div>

</div>

<div id="outline-container-4-2" class="outline-3">
<h3 id="sec-4-2"><span class="section-number-3">4.2</span> A sink with a slot</h3>
<div class="outline-text-3" id="text-4-2">

<p>An object acts as the sink and a function as the slot that connects the source
to the sink
</p>


<pre class="src src-js"><span class="org-keyword">var</span> <span class="org-variable-name">sink</span> = {
  <span class="org-function-name">dataUpdated</span>: <span class="org-keyword">function</span> (<span class="org-variable-name">name</span>, <span class="org-variable-name">data</span>) {
    print(<span class="org-string">"ping"</span>);
  }
};
</pre>

<p>
The name of the sink Object can be anything
</p>


<pre class="src src-js"><span class="org-keyword">var</span> <span class="org-variable-name">CatDog</span> = {
  <span class="org-function-name">dataUpdated</span>: <span class="org-keyword">function</span> (<span class="org-variable-name">name</span>, <span class="org-variable-name">data</span>) {
    print(<span class="org-string">"ping"</span>);
  }
};
</pre>

<p>
The name of the slot function however is to be <code>dataUpdated</code>.  The function
always receives two parameters.  We'll dicuss their content in a bit.
</p>
</div>

</div>

<div id="outline-container-4-3" class="outline-3">
<h3 id="sec-4-3"><span class="section-number-3">4.3</span> Connecting the slot to a source</h3>
<div class="outline-text-3" id="text-4-3">

<p>A plasma engine provides sources.  They're connected to via their
<code>connectSource</code> method.  The arguments this method takes are the name of the
source, the sink object and the desired interval length in which sink's
<code>dataUpdated</code> slot should be called.
</p>


<pre class="src src-js"><span class="org-keyword">var</span> <span class="org-variable-name">engine</span> = dataEngine(<span class="org-string">"SourcesServingEngine"</span>)
<span class="org-keyword">var</span> <span class="org-variable-name">intervalInMilliSeconds</span> = 1000;  <span class="org-comment-delimiter">// </span><span class="org-comment">one second</span>
engine.connectSource(<span class="org-string">"SourceOfInterest"</span>, sink, intervalInMilliSeconds);
</pre>

<p>
This code has a flaw.  The connection might fail of
</p><ul>
<li>the source doesn't exist
</li>
<li>the sink object doesn't define the <code>dataUpdated</code> slot.
</li>
</ul>

<p>This flowing version doesn't really handle these situation, but at least tells
us about it.
</p>


<pre class="src src-js"><span class="org-keyword">var</span> <span class="org-variable-name">engine</span> = dataEngine(<span class="org-string">"SourcesServingEngine"</span>)
<span class="org-keyword">var</span> <span class="org-variable-name">intervalInMilliSeconds</span> = 1000;  <span class="org-comment-delimiter">// </span><span class="org-comment">one second</span>
<span class="org-keyword">if</span> (! engine.connectSource(<span class="org-string">"SourceOfInterest"</span>, sink, intervalInMilliSeconds) ) {
  print(<span class="org-string">"connection attempt to SourceOfInterest in SourcesServingEngine failed D:"</span>);
}
</pre>


<p>
To actually find a data source and a source it provides we gonna use
</p><pre class="example">
% plasmaengineexplorer
</pre>


<div id="fig-plasmaengineexplorer" class="figure">
<p><img src="images/plasmaengineexplorer.png" width="790" alt="images/plasmaengineexplorer.png" /></p>
<p>Plasma engine explorer</p>
</div>
<p>
In image <a href="#fig-plasmaengineexplorer">plasmaengineexplorer</a> the source <i>Local</i> of the <i>time</i> data
engine is expanded.  This code uses it
</p>


<pre class="src src-js"><span class="org-keyword">var</span> <span class="org-variable-name">sink</span> = {
  <span class="org-function-name">dataUpdated</span>: <span class="org-keyword">function</span> (<span class="org-variable-name">name</span>, <span class="org-variable-name">data</span>) {
    print(<span class="org-string">"ping"</span>);
  }
};

<span class="org-keyword">var</span> <span class="org-variable-name">engine</span> = dataEngine(<span class="org-string">"time"</span>);
<span class="org-keyword">if</span> ( engine.connectSource(<span class="org-string">"Local"</span>, sink, 1000) ) {
  print(<span class="org-string">"connection established"</span>);
} <span class="org-keyword">else</span> {
  print(<span class="org-string">"connection attempt failed"</span>);
}

print(<span class="org-string">"main.js ends here"</span>);
</pre>

<p>
and results in
</p><pre class="example">
ping
connection established
main.js ends here
ping
ping
ping
</pre>


<p>
As you can see, connectSource calls the dataUpdated slot.  So make sure that
it's already there.  If not
</p>


<pre class="src src-js"><span class="org-keyword">var</span> <span class="org-variable-name">sink</span> = {};

<span class="org-keyword">var</span> <span class="org-variable-name">engine</span> = dataEngine(<span class="org-string">"time"</span>);
<span class="org-keyword">if</span> ( engine.connectSource(<span class="org-string">"Local"</span>, sink, 1000) ) {
  print(<span class="org-string">"connection established"</span>);
} <span class="org-keyword">else</span> {
  print(<span class="org-string">"connection attempt failed"</span>);
}

sink.dataUpdated = <span class="org-keyword">function</span> (<span class="org-variable-name">name</span>, <span class="org-variable-name">data</span>) {
  print(<span class="org-string">"ping"</span>);
}

print(<span class="org-string">"main.js ends here"</span>);
</pre>

<p>
we'll get
</p><pre class="example">
% plasmoidviewer .
connection attempt failed
main.js ends here
%
</pre>


</div>

</div>

<div id="outline-container-4-4" class="outline-3">
<h3 id="sec-4-4"><span class="section-number-3">4.4</span> Exploring a data source</h3>
<div class="outline-text-3" id="text-4-4">

<p>So far it is only confirmed that <code>dataUpdated</code> was called back.  Now we take a
look at the value of the parameters it is called with by the data engine.
</p>
<p>
First the <code>name</code>.  This code for the sink section
</p>


<pre class="src src-js"><span class="org-keyword">var</span> <span class="org-variable-name">sink</span> = {
  <span class="org-function-name">dataUpdated</span>: <span class="org-keyword">function</span> (<span class="org-variable-name">name</span>, <span class="org-variable-name">data</span>) {
    print(name);
  }
};
</pre>

<p>
results in
</p><pre class="example">
Local
connection established
main.js ends here
Local
Local
...
</pre>

<p>This is the same name we used with <code>connectSource</code>.  This becomes important
when we subscribe to more than one data source.
</p>


<pre class="src src-js"><span class="org-keyword">var</span> <span class="org-variable-name">sink</span> = {
  <span class="org-function-name">dataUpdated</span>: <span class="org-keyword">function</span> (<span class="org-variable-name">name</span>, <span class="org-variable-name">data</span>) {
    print(name);
  }
};

<span class="org-keyword">var</span> <span class="org-variable-name">engine</span> = dataEngine(<span class="org-string">"time"</span>);
<span class="org-keyword">if</span> ( engine.connectSource(<span class="org-string">"Local"</span>, sink, 1000) ) {
  print(<span class="org-string">"connection to 'Local' in 'time' established"</span>);
} <span class="org-keyword">else</span> {
  print(<span class="org-string">"connection attempt to 'Local' in 'time' failed"</span>);
}
<span class="org-comment-delimiter">//</span>
<span class="org-keyword">if</span> ( engine.connectSource(<span class="org-string">"Europe/London"</span>, sink, 1000) ) {
  print(<span class="org-string">"connection to 'Europe/London' in 'time' established"</span>);
} <span class="org-keyword">else</span> {
  print(<span class="org-string">"connection attempt to 'Europe/London' in 'time' failed"</span>);
}

print(<span class="org-string">"main.js ends here"</span>);
</pre>

<pre class="example">
 % plasmoidviewer .
Local
connection to 'Local' in 'time' established
Europe/London
connection to 'Europe/London' in 'time' established
main.js ends here
Local
Europe/London
Local
Europe/Londo
</pre>


<p>
Now the <code>data</code>.  We're using the version that only connects to <code>Local</code> in
<code>time</code> with this slot definition
</p>


<pre class="src src-js"><span class="org-keyword">var</span> <span class="org-variable-name">sink</span> = {
  <span class="org-function-name">dataUpdated</span>: <span class="org-keyword">function</span> (<span class="org-variable-name">name</span>, <span class="org-variable-name">data</span>) {
    print(<span class="org-string">"===== data ====="</span>);
    <span class="org-keyword">for</span>(<span class="org-keyword">var</span> <span class="org-variable-name">k</span> <span class="org-keyword">in</span> data) {
      print(<span class="org-string">"key : "</span> + k);
      print(<span class="org-string">"data[key] : "</span> + data[k]);
      print(<span class="org-string">"typeof data[key] : "</span> + <span class="org-keyword">typeof</span> data[k]);
      print(<span class="org-string">"----"</span>);
    }
  }
};
</pre>

<p>
It results in
</p><pre class="example">
===== data =====
key : Timezone Continent
typeof data[key] : string
data[key] : Europe
----
key : Offset
typeof data[key] : number
data[key] : 3600
----
key : DateTime
typeof data[key] : object
data[key] : Sun Feb 12 2012 09:46:52 GMT+0100 (CET)
----
key : Timezone
typeof data[key] : string
data[key] : Europe/Berlin
----
key : Time
typeof data[key] : object
data[key] : 09:46:52
----
key : Date
typeof data[key] : object
data[key] : Sun Feb 12 2012 00:00:00 GMT+0100 (CET)
----
key : Timezone City
typeof data[key] : string
data[key] : Berlin
</pre>

<p>The <code>Offset</code> looks off, doesn't it?.  That's because its unit is seconds.  My
time zone has an offset of
</p><ul>
<li>\(3600\:s = \dfrac{3600\:s \cdot 1\:min}{60\:s} = 60\:min\)
</li>
<li>\(60\:min = \dfrac{60\:min \cdot 1\:h}{60\:min} = 1\:h\) .
</li>
</ul>


<p>
If you compare this data with what is shown in <a href="#fig-plasmaengineexplorer">plasmaengineexplorer</a>,
then you'll notice it being exactly the same, except for the actual point in
time.  For Qt data types that don't have an builtin equivalent in Javascript we
get an object.
</p><ul>
<li><a href="http://doc.qt.nokia.com/4.7-snapshot/scripting.html#conversion-between-qtscript-and-c-types">Conversion between QtScript and C++ types</a>
</li>
</ul>

<p>Lets have a peek into what one of these converted Qt types has to offer
</p>


<pre class="src src-js"><span class="org-keyword">var</span> <span class="org-variable-name">sink</span> = {
  <span class="org-function-name">dataUpdated</span>: <span class="org-keyword">function</span> (<span class="org-variable-name">name</span>, <span class="org-variable-name">data</span>) {
    print(<span class="org-string">"==== data ====="</span>);
    <span class="org-keyword">var</span> <span class="org-variable-name">dateTime</span> = data[<span class="org-string">"DateTime"</span>]
    print(<span class="org-string">'&lt;properties of data["DateTime"]'</span>);
    <span class="org-keyword">for</span>(<span class="org-keyword">var</span> <span class="org-variable-name">k</span> <span class="org-keyword">in</span> dateTime) {
      print(<span class="org-string">"key : "</span> + k);
      print(<span class="org-string">'typeof dateTime[key] : '</span> + <span class="org-keyword">typeof</span> dateTime[k]);
      print(<span class="org-string">'dateTime[key] : '</span> + dateTime[k]);
    }
    print(<span class="org-string">'&lt;/properties of data["DateTime"]'</span>);
  }
};
</pre>

<pre class="example">
==== data =====
&lt;properties of data["DateTime"]
&lt;/properties of data["DateTime"]
</pre>

<p>Nothing?  That is correct.  This shell around an C++ object only hands out you
a string representation of its value to Javascript.  Though they are not
showing up with the code above, these objects have the following methods
</p><ul>
<li><code>toString()</code>
</li>
<li><code>toLocaleString()</code>
</li>
<li><code>valueOf()</code>
</li>
<li><code>hasOwnProperty(V)</code>
</li>
<li><code>isPrototypeOf(V)</code>
</li>
<li><code>propertyIsEnumerable(V)</code>
</li>
</ul>

<p>The Qt docs just mention their existence
</p><ul>
<li><a href="http://doc.qt.nokia.com/4.7-snapshot/ecmascript.html">http://doc.qt.nokia.com/4.7-snapshot/ecmascript.html</a>
</li>
</ul>

<p>For real information head over to Mozilla
</p><ul>
<li><a href="https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Object">https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Object</a>
</li>
</ul>

<p>However, you probably only ever use <code>toString()</code>.
</p>


<pre class="src src-js"><span class="org-keyword">var</span> <span class="org-variable-name">sink</span> = {
  <span class="org-function-name">dataUpdated</span>: <span class="org-keyword">function</span> (<span class="org-variable-name">name</span>, <span class="org-variable-name">data</span>) {
    print(<span class="org-string">"==== data ====="</span>);
    <span class="org-keyword">var</span> <span class="org-variable-name">dateTime</span> = data[<span class="org-string">"DateTime"</span>]
    print(<span class="org-string">"typeof dateTime : "</span> + <span class="org-keyword">typeof</span> dateTime);
    print(<span class="org-string">"typeof dateTime.toString : "</span> + <span class="org-keyword">typeof</span> dateTime.toString);
    print(<span class="org-string">"typeof dateTime.toString() : "</span> + <span class="org-keyword">typeof</span> dateTime.toString());
    print(<span class="org-string">"dateTime.toString() : "</span> + dateTime.toString());
  }
};
</pre>

<pre class="example">
==== data =====
typeof dateTime : object
typeof dateTime.toString : function
typeof dateTime.toString() : string
dateTime.toString() : Sun Feb 12 2012 11:45:39 GMT+0100 (CET)
</pre>


</div>
</div>
</div>
</div>

</body>
</html>
